<html>
    <head>
        <meta charset="utf-8">
        <title>TaiwanSamYT-自製遊戲</title>
    </head>
    <body>
        <a href="http://hmikeflower.github.io/w5/sam/index.html"><button>回首頁</button></a><br>



        <img src="http://hmikeflower.github.io/w5/sam/pictures/black.png" id="main" height="10" width="10">
        <img src="http://hmikeflower.github.io/w5/sam/pictures/black.png" id="floor1" height="20" width="30">
        <img src="http://hmikeflower.github.io/w5/sam/pictures/black.png" id="floor2" height="20" width="30">
        <img src="http://hmikeflower.github.io/w5/sam/pictures/black.png" id="floor3" height="20" width="30">
        <img src="http://hmikeflower.github.io/w5/sam/pictures/black.png" id="floor4" height="20" width="30">
        <img src="http://hmikeflower.github.io/w5/sam/pictures/black.png" id="floor5" height="20" width="30">
        <img src="http://hmikeflower.github.io/w5/sam/pictures/black.png" id="floor6" height="20" width="30">
        <img src="http://hmikeflower.github.io/w5/sam/pictures/black.png" id="floor7" height="20" width="30">
        <img src="http://hmikeflower.github.io/w5/sam/pictures/black.png" id="floor8" height="20" width="30">
        <img src="http://hmikeflower.github.io/w5/sam/pictures/black.png" id="floor9" height="20" width="30">
        <img src="http://hmikeflower.github.io/w5/sam/pictures/black.png" id="floor10" height="20" width="30">

        <br>
        <button onclick="start()" id="start">開始遊戲</button>
        <button onclick="startorstop()" id="startorstop">開始遊戲</button>
        <div id="score">最高分數:0 分數:0</div>

        <script>
            var xpos=Array[0,0,0,0,0,0,0,0,0,0,0];
            var ypos=Array[0,-300,-300,-300,-300,-300,-300,-300,-300,-300,-300];
            var xspeed=0;
            var yspeed=0;
            var yofall=0;
            var score=0;
            var highestscore=0;
            var touch=false;

            setInterval("startthegame()",30)



            function updatescreen(){
                summonfloor();
                i=0;
                while(i<11){
                    document.getElementById("floor"+String(i)).style.top=(180-ypos[i])*2;
                    document.getElementById("floor"+String(i)).style.left=xpos[i]*2;
                    i=i+1;}}

            function updateposition(){
                xpos[0]=xpos[0]+xspeed;
                i=1;
                while(i<11){
                    ypos[i]=ypos[i]+yspeed;
                    i=i+1;}
                if(xpos[0]<-240){
                    xpos[0]=240;}
                if(xpos[0]>240){
                    xpos[0]=-240;}
                xspeed=xspeed*0.97;
                yspeed=yspeed+0.5;
                yofall=yofall+yspeed;}

            function summonfloor(){
                i=0;
                while(i<11){
                    if(ypos[i]<-240){
                        j=1;
                        while(j<11){
                            i2=1;
                            while(i2<11){
                                if(ypos[i]+j*90!=ypos[i2]){
                                    i2=i2+1;}
                                else{
                                    break;}}
                            if(i2==11){
                                xpos[i]=Number(Math.floor(400*(Math.random()-0.5)));
                                ypos[i]=ypos[i]+j*90;}}}}}
            
            var gameevent="waitforstart";
            function startthegame(){
                if(gameevent=="firststart"){
                    var xpos=Array[0,0,0,0,0,0,0,0,0,0,0];
                    var ypos=Array[0,-300,-300,-300,-300,-300,-300,-300,-300,-300,-300];
                    var xspeed=0;
                    var yspeed=0;
                    var yofall=0;
                    var score=0;
                    var touch=false;
                    gameevent="keep";}
                else if(gameevent=="keep"){
                    var body=document.body;
                    body.addEventListener("keydown",function(e){
                        if (e.keyCode==37||e.keyCode==65){
                            xspeed=xspeed-(1-0.2*Number(xspeed<-8));}
                        if (e.keyCode==39||e.keyCode==68){
                            xspeed=xspeed+(1-0.2*Number(xspeed>8));}})
                    detectplayertouchfloor();
                    detectfall();
                    updateposition();
                    updatescreen();
                    updatescore();}}
            


            function start(){
                gameevent="firststart";
                document.getElementById("start").innerHTML="重新開始";
                document.getElementById("startorstop").innerHTML="暫停";}

            function startorstop(){
                if(gameevent=="waitforstart"){
                    gameevent="firststart";
                    document.getElementById("start").innerHTML="重新開始";
                    document.getElementById("startorstop").innerHTML="暫停";}
                else if(gameevent=="keep"){
                    document.getElementById("startorstop").innerHTML="繼續遊戲";
                    gameevent="wait";}
                else if(gameevent=="wait"){
                    document.getElementById("startorstop").innerHTML="暫停";
                    gameevent="keep";}}


            function updatescore(){
                if(yofall>score){
                    score=yofall;}
                if(score>highestscore){
                    highestscore=score;}
                    document.getElementById("score").innerHTML="最高分數:"+String(highestscore)+" 分數:"+String(score);}



            function detectsingletouch(A_xpos,A_ypos,A_height,A_width,B_xpos,B_ypos,B_height,B_width){
                if(B_xpos-A_xpos<A_width&&A_xpos-B_xpos<B_width&&B_ypos-A_ypos<A_height&&A_ypos-B_ypos<B_height){
                    touch=true;}
                else{
                    touch=false;}}


            
        </script>
    </body>
</html>